# 管理员管理问题修复说明

## 问题概述

在运行管理员管理功能时遇到了以下问题：

1. **Ant Design Vue 警告**：`visible` 属性将被 `open` 替换
2. **数据库查询错误**：找不到超级管理员信息（手机号 13800138000）
3. **HTTP 406 错误**：API 请求格式问题

## 已修复的问题

### 1. Ant Design Vue 警告修复
- 已将 `v-model:visible` 替换为 `v-model:open`
- 修复了模态框的兼容性问题

### 2. 超级管理员查找逻辑优化
- 改进了超级管理员查找逻辑，现在会：
  1. 首先尝试查找手机号为 `13800138000` 的超级管理员
  2. 如果找不到，尝试查找第一个 `super_admin` 角色的用户
  3. 如果还是没有，会给出明确的错误提示

### 3. 数据库初始化脚本
- 创建了 `init_super_admin.sql` 脚本，用于初始化超级管理员账户

## 解决方案

### 方法一：运行初始化脚本（推荐）

1. 连接到你的 Supabase 数据库
2. 运行 `init_super_admin.sql` 脚本：

```sql
\i init_super_admin.sql
```

或者直接在 Supabase SQL 编辑器中执行脚本内容。

### 方法二：手动创建超级管理员

如果不想运行脚本，可以手动创建超级管理员：

1. 在 `user_profiles` 表中插入一条记录：

```sql
INSERT INTO user_profiles (
    id,
    phone_number,
    name,
    organization,
    role,
    password_hash
) VALUES (
    gen_random_uuid(),
    '13800138000',
    '超级管理员',
    '系统管理',
    'super_admin',
    md5('admin123')
);
```

2. 在 `admin_management` 表中插入对应记录：

```sql
INSERT INTO admin_management (
    admin_id,
    managed_by,
    role,
    status,
    created_by
)
SELECT 
    up.id,
    up.id,
    'super_admin',
    'active',
    up.id
FROM user_profiles up
WHERE up.phone_number = '13800138000';
```

## 默认登录信息

- **手机号**：13800138000
- **密码**：admin123
- **角色**：超级管理员

## 代码修改详情

### AdminManagement.vue 修改

1. **第 320 行左右**：修复了模态框的 `v-model:visible` 为 `v-model:open`
2. **第 460-490 行左右**：优化了超级管理员查找逻辑
3. **第 500 行左右**：修复了插入操作中的变量引用问题

### 新增文件

- `init_super_admin.sql`：超级管理员初始化脚本

## 验证修复

修复后，管理员管理功能应该能够：

1. ✅ 正常显示管理员列表
2. ✅ 成功添加新的管理员
3. ✅ 不再出现 Ant Design Vue 警告
4. ✅ 不再出现 "找不到超级管理员信息" 错误

## 注意事项

- 确保 Supabase 服务正常运行
- 确保数据库连接配置正确
- 如果仍然遇到问题，请检查数据库表结构和权限设置

## 后续维护

- 定期备份数据库
- 及时更新依赖包版本
- 监控系统日志，及时发现并解决问题